# *Creating Musical Artifacts* : Score-Based Generative Models for Music Generation

[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)

[![My Project Status](https://img.shields.io/badge/project-active-green)](https://github.com/henriupton99/score-based-generative-models)


## Autor
Henri UPTON

# Overview

- [1. Usage](#1-Usage)
  - [1.1. Installation](#11-installation)
  - [1.2. Utilitaries / functions](#12-utilitaries-functions)
- [2. Problem Framing](#2-problem-framing)
- [3. MAESTRO Dataset](#3-maestro-dataset)
- [4. Running Scripts](#4-running-scripts)
- [5. Technical Results](#5-technical-results)
- [6. Ressources](#6-ressources)
  - [6.1. GitHubs](#61-githubs)
  - [6.2. Research Papers](#62-research-papers)


# 1. Usage

## 1.1. Installation

Frist, clone the repository :
```python
git clone https://github.com/henriupton99/score-based-generative-models.git
```

Then, create a virtual enviroment dedicated to this repository :
```python
conda create -n score-based-generative-models
conda activate score-based-generative-models
```

Then, install the requirements : 

```python
pip install -r requirements.txt
```

## 1.2. Utilitaries / Functions

The script [config.py](config.py) is about setting all hyperparameters for future data loading and training :
```python
from config import config
```

The script [utils.py](utils.py) provide two classes for pre-processing of MAESTRO Dataset and post-processing of samples generated by Score Based Generative Model :
```python
# pre-processing of MAESTRO data samples :
from utils import process_maestro_data
from process_maestro_data import unzip_data, read_csv_data, read_midi_file, get_midi_metadata, plot_piano_roll

# post-processing of generated samples :
from utils import process_generated_samples
from process_generated_samples import piano_roll_to_midi, plot_piano_roll
```

The script [data_builder.py](data_builder.py) is about creating a Pytorch Dataset instance for specific MAESTRO Dataset (c.f 3. MAESTRO Dataset for informations about the Dataset) :
```python
from data_builder import MaestroDataset
```
The scripts [model.py](model.py), [sampler.py](sampler.py), [sde.py](sde.py) come from hands on Notebook of the Score Based Generative Model structure from Yang Song and al. (https://colab.research.google.com/drive/120kYYBOVa1i0TD85RjlEkFjaWDxSFUx3?usp=sharing). It provides structure for the model (U-net), sampling (Euler-Maruyama), and Stochastic Differential Equation Dynamic (SDE) :

```python
from model import ScoreNet, loss_fn
from sampler import Euler_Maruyama_sampler
from sde import marginal_prob_std, diffusion_coeff
```

# 2. Problem Framing

Score-Based Generative Modeling (SBGM) is a new approach to generative modeling that uses the score function to estimate the gradient of the log-likelihood function. The log-likelihood function is used to measure how well a model can generate a given set of data. SBGM can provide advantages regarding other generative modeling approaches, such as Generative Adversarial Networks (GANs) and Variational Autoencoders (VAEs). Among them, the ability to generate high-quality samples and the ability to estimate the density of the data is crutial.

Based on SBGM framework and an algorithm for training such models, we explore the possibilities of music generation based on the MAESTRO (MIDI and Audio Edited for Synchronous TRacks and Organization) database.

# 3. MAESTRO Dataset

The MAESTRO (MIDI and Audio Edited for Synchronous TRacks and Organization) dataset is a large-scale dataset of piano performances that was created by the Music Technology Group at Universitat Pompeu Fabra in Barcelona, Spain. It was designed to support research on multi-modal music performance analysis and generation.

The dataset contains over 200 hours of aligned MIDI and audio recordings of classical piano performances, which were obtained from publicly available sources such as YouTube and the International Piano-e-Competition. The performances were selected to cover a wide range of styles, composers, and pianists, and were manually aligned to ensure accurate synchronization between the MIDI and audio data.

This Dataset comes from TensorFlow website : https://magenta.tensorflow.org/datasets/maestro#v300

## 3.1. Piano Roll Matrix

We work with piano roll matrix : 

![Example Image](./figures/piano_roll_original/piano_roll_579.png)

# 4. Running Scripts

| Script Name | Output |
|--------------|------------|
| <span style="color: red;"> *training_main.py*</span> | <span style="color: red;">**loads the data from the MEASTRO dataset as a Pytorch dataset, launches the model (defined in model.py script) training phase and saves the model in the ./data folder (ckpt.pth)**</span>|
| <span style="color: orange;">*sampling_main.py*</span> | <span style="color: orange;">**loads the previously trained model with the training_main.py script, and generates musical samples with one of the samplers defined in sampler.py. The musical samples in midi format (.mid) generated are available in the folder ./data/samples_midi**</span> |
| <span style="color: green;">*piano_roll_main.py*</span> | <span style="color: green;">**loads the samples previously generated by the sampling_main.py script and generates their piano roll matrix (c.f 3. MAESTRO Dataset). The constructed images are available in the folder ./figures/piano_roll_generated/**</span> |


# 5. Technical Results

Example of piano roll matrix from a generated sample :

![Example Image](./figures/piano_roll_generated/piano_roll_3.png)

Soundcloud link : 

https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/1500676579&color=%23ff9900&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true

# 6. Ressources

## 6.1. GitHubs / Links

[Deep Learning Course (Project Page)](https://marcocuturi.net/dl.html)

[GitHub from Yang Song about SBGM (Pytorch Version)](https://github.com/yang-song/score_sde_pytorch) 

[Blog post about the Score Based Generative Model](https://yang-song.github.io/blog/2021/score/)

## 6.2. Research Papers
- [@sbgm] Yang Song, Jascha Sohl-Dickstein, Diederik P Kingma, Abhishek Kumar, Stefano Ermon, Ben Poole. (2018). **Score-Based Generative Modeling through Stochastic Differential Equations.** https://openreview.net/forum?id=PxTIG12RRHS
